apiVersion: 1

# =============================================================================
# Grafana Notification Policy Configuration
#
# This configures the notification routing and repeat intervals.
# Updated 2026-01-10:
#   - Set reasonable repeat_interval (4h) to prevent alert spam
#   - Configure group_wait/group_interval for better batching
#
# NOTE: Contact point (Pushover) is configured via Grafana UI, not here.
#       This file only manages the notification policy (timing/routing).
# =============================================================================

# Notification policies - control routing and timing
policies:
  - orgId: 1
    # Root policy - catches all alerts
    # Uses the existing "Pushover" contact point configured in Grafana
    receiver: Pushover
    group_by:
      - alertname
      - grafana_folder
    # Wait 30s before sending initial notification (allows grouping)
    group_wait: 30s
    # Wait 5m between notification updates for the same group
    group_interval: 5m
    # Don't repeat the same alert more than once per 4 hours
    repeat_interval: 4h
    routes:
      # Critical alerts - shorter repeat interval, but still reasonable
      - receiver: Pushover
        matchers:
          - severity = critical
        group_wait: 10s
        group_interval: 2m
        repeat_interval: 1h
        continue: false
      # Warning alerts - longer repeat interval
      - receiver: Pushover
        matchers:
          - severity = warning
        repeat_interval: 8h
        continue: false
